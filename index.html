<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Peminjaman Buku Perpustakaan</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-book"></i> Sistem Peminjaman Buku Perpustakaan</h1>
            <p class="subtitle">Manajemen peminjaman buku dengan perhitungan denda otomatis</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" data-tab="peminjaman"><i class="fas fa-book-reader"></i> Peminjaman</button>
            <button class="tab-btn" data-tab="pengembalian"><i class="fas fa-book-open"></i> Pengembalian</button>
            <button class="tab-btn" data-tab="riwayat"><i class="fas fa-history"></i> Riwayat</button>
            <button class="tab-btn" data-tab="laporan"><i class="fas fa-chart-bar"></i> Laporan</button>
        </div>

        <div class="tab-content active" id="peminjaman">
            <div class="card info-card">
                <h2><i class="fas fa-info-circle"></i> Ketentuan Peminjaman</h2>
                <ul>
                    <li><i class="fas fa-check-circle"></i> Peminjaman buku dilakukan per minggu</li>
                    <li><i class="fas fa-exclamation-triangle"></i> <strong>Denda keterlambatan: Rp5.000 per hari</strong> (termasuk weekend)</li>
                    <li><i class="fas fa-calculator"></i> Perhitungan denda dimulai dari hari setelah jatuh tempo</li>
                    <li><i class="fas fa-file-invoice"></i> Invoice otomatis dibuat untuk pembayaran denda</li>
                </ul>
            </div>

            <div class="card form-card">
                <h2><i class="fas fa-edit"></i> Form Peminjaman Buku</h2>
                <form id="formPeminjaman">
                    <div class="form-group">
                        <label for="namaPeminjam"><i class="fas fa-user"></i> Nama Peminjam:</label>
                        <input type="text" id="namaPeminjam" required placeholder="Masukkan nama lengkap">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="noHp"><i class="fas fa-phone"></i> No. HP:</label>
                            <input type="tel" id="noHp" required placeholder="081234567890">
                        </div>
                        <div class="form-group">
                            <label for="email"><i class="fas fa-envelope"></i> Email (opsional):</label>
                            <input type="email" id="email" placeholder="email@contoh.com">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="judulBuku"><i class="fas fa-book"></i> Judul Buku:</label>
                            <input type="text" id="judulBuku" required placeholder="Judul buku yang dipinjam">
                        </div>
                        <div class="form-group">
                            <label for="kodeBuku"><i class="fas fa-barcode"></i> Kode Buku:</label>
                            <input type="text" id="kodeBuku" required placeholder="Kode unik buku">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tanggalPinjam"><i class="fas fa-calendar-alt"></i> Tanggal Pinjam:</label>
                            <input type="date" id="tanggalPinjam" required>
                        </div>
                        <div class="form-group">
                            <label for="lamaPinjam"><i class="fas fa-clock"></i> Lama Pinjam (minggu):</label>
                            <input type="number" id="lamaPinjam" min="1" value="1" required>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-primary" id="btnSimpan">
                            <i class="fas fa-save"></i> Simpan Peminjaman
                        </button>
                        <button type="reset" class="btn btn-secondary">
                            <i class="fas fa-undo"></i> Reset Form
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div class="tab-content" id="pengembalian">
            <div class="card">
                <h2><i class="fas fa-exchange-alt"></i> Proses Pengembalian Buku</h2>
                
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchPeminjaman" placeholder="Cari berdasarkan nama, judul buku, atau kode...">
                </div>
                
                <div class="table-responsive">
                    <table id="tabelPengembalian">
                        <thead>
                            <tr>
                                <th>No.</th>
                                <th>Nama Peminjam</th>
                                <th>Judul Buku</th>
                                <th>Kode Buku</th>
                                <th>Tanggal Pinjam</th>
                                <th>Jatuh Tempo</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="pengembalianBody">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div id="invoiceSection" class="invoice-section" style="display: none;">
                <div class="card">
                    <div class="invoice-header">
                        <div class="invoice-logo">
                            <i class="fas fa-book-open fa-3x"></i>
                            <h2>Perpustakaan XYZ</h2>
                        </div>
                        <div class="invoice-meta">
                            <h3>INVOICE DENDA</h3>
                            <p><span>No. Invoice:</span> <span id="invoiceNumber">INV-2023-001</span></p>
                            <p><span>Tanggal:</span> <span id="invoiceDate">01 Jan 2023</span></p>
                        </div>
                    </div>
                    
                    <div class="invoice-details">
                        <div class="invoice-customer">
                            <h4>Detail Peminjam:</h4>
                            <p><span>Nama:</span> <span id="invoiceNama">-</span></p>
                            <p><span>No. HP:</span> <span id="invoiceHp">-</span></p>
                            <p><span>Email:</span> <span id="invoiceEmail">-</span></p>
                        </div>
                        <div class="invoice-book">
                            <h4>Detail Buku:</h4>
                            <p><span>Judul:</span> <span id="invoiceJudul">-</span></p>
                            <p><span>Kode:</span> <span id="invoiceKode">-</span></p>
                        </div>
                    </div>
                    
                    <div class="keterlambatan-info">
                        <h4><i class="fas fa-clock"></i> Detail Keterlambatan:</h4>
                        <div class="keterlambatan-detail">
                            <div>
                                <p>Tanggal Pinjam</p>
                                <strong id="detailPinjam">-</strong>
                            </div>
                            <div>
                                <p>Jatuh Tempo</p>
                                <strong id="detailTempo">-</strong>
                            </div>
                            <div>
                                <p>Dikembalikan</p>
                                <strong id="detailKembali">-</strong>
                            </div>
                            <div>
                                <p>Keterlambatan</p>
                                <strong id="detailTelat">-</strong>
                            </div>
                        </div>
                    </div>
                    
                    <table class="invoice-items">
                        <thead>
                            <tr>
                                <th>Deskripsi</th>
                                <th>Jumlah Hari</th>
                                <th>Tarif Denda</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody id="invoiceItems">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="3" class="text-right"><strong>Total Denda:</strong></td>
                                <td class="text-bold" id="invoiceTotal">Rp0</td>
                            </tr>
                        </tfoot>
                    </table>
                    
                    <div class="payment-methods">
                        <h4><i class="fas fa-money-bill-wave"></i> Metode Pembayaran:</h4>
                        <div class="methods">
                            <div>
                                <i class="fas fa-university"></i>
                                <p>Transfer Bank</p>
                                <p>BCA 1234567890 a.n. Perpustakaan XYZ</p>
                            </div>
                            <div>
                                <i class="fas fa-money-bill-alt"></i>
                                <p>Tunai</p>
                                <p>Di kantor perpustakaan</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="invoice-footer">
                        <p><i class="fas fa-info-circle"></i> Harap simpan invoice ini sebagai bukti pembayaran</p>
                        <div class="invoice-actions">
                            <button class="btn btn-primary" id="btnPrintInvoice">
                                <i class="fas fa-print"></i> Cetak Invoice
                            </button>
                            <button class="btn btn-secondary" id="btnCloseInvoice">
                                <i class="fas fa-times"></i> Tutup
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="riwayat">
            <div class="card">
                <h2><i class="fas fa-history"></i> Riwayat Peminjaman</h2>
                
                <div class="filter-controls">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchRiwayat" placeholder="Cari riwayat...">
                    </div>
                    <div class="date-filter">
                        <label for="filterDari"><i class="fas fa-calendar"></i> Dari:</label>
                        <input type="date" id="filterDari">
                        <label for="filterSampai">Sampai:</label>
                        <input type="date" id="filterSampai">
                        <button class="btn btn-small" id="btnFilter">
                            <i class="fas fa-filter"></i> Filter
                        </button>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table id="tabelRiwayat">
                        <thead>
                            <tr>
                                <th>No.</th>
                                <th>Nama Peminjam</th>
                                <th>Judul Buku</th>
                                <th>Kode Buku</th>
                                <th>Tanggal Pinjam</th>
                                <th>Jatuh Tempo</th>
                                <th>Pengembalian</th>
                                <th>Keterlambatan</th>
                                <th>Denda</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="riwayatBody">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div class="table-footer">
                    <div class="summary">
                        <p>Total Data: <span id="totalData">0</span></p>
                        <p>Total Denda: <span id="totalDenda">Rp0</span></p>
                    </div>
                    <div class="pagination">
                        <button class="btn btn-small" id="btnPrev">
                            <i class="fas fa-chevron-left"></i> Sebelumnya
                        </button>
                        <span id="pageInfo">Halaman 1 dari 1</span>
                        <button class="btn btn-small" id="btnNext">
                            Selanjutnya <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="laporan">
            <div class="card">
                <h2><i class="fas fa-chart-pie"></i> Laporan Peminjaman</h2>
                
                <div class="report-controls">
                    <div>
                        <label for="reportType">Jenis Laporan:</label>
                        <select id="reportType">
                            <option value="mingguan">Mingguan</option>
                            <option value="bulanan">Bulanan</option>
                            <option value="tahunan">Tahunan</option>
                        </select>
                    </div>
                    <div id="dateRangeControls">
                        <label for="reportDate">Pilih Minggu:</label>
                        <input type="week" id="reportDate">
                    </div>
                    <button class="btn btn-primary" id="btnGenerateReport">
                        <i class="fas fa-sync-alt"></i> Generate Laporan
                    </button>
                    <button class="btn btn-secondary" id="btnExportReport">
                        <i class="fas fa-file-export"></i> Export PDF
                    </button>
                </div>
                
                <div class="report-summary">
                    <div class="summary-card">
                        <div class="summary-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="summary-content">
                            <p>Total Peminjaman</p>
                            <h3 id="totalPeminjaman">0</h3>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="summary-content">
                            <p>Tepat Waktu</p>
                            <h3 id="tepatWaktu">0</h3>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="summary-content">
                            <p>Terlambat</p>
                            <h3 id="terlambat">0</h3>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="summary-content">
                            <p>Total Denda</p>
                            <h3 id="reportDenda">Rp0</h3>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="reportChart"></canvas>
                </div>
                
                <div class="table-responsive">
                    <table id="reportTable">
                        <thead>
                            <tr>
                                <th>No.</th>
                                <th>Tanggal</th>
                                <th>Jumlah Peminjaman</th>
                                <th>Pengembalian Tepat Waktu</th>
                                <th>Keterlambatan</th>
                                <th>Total Denda</th>
                            </tr>
                        </thead>
                        <tbody id="reportBody">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal untuk pengembalian -->
    <div id="pengembalianModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-book-open"></i> Pengembalian Buku</h3>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="modalContent">
                    <!-- Konten akan diisi oleh JavaScript -->
                </div>
                
                <div class="form-group">
                    <label for="modalTanggalKembali"><i class="fas fa-calendar-check"></i> Tanggal Kembali:</label>
                    <input type="date" id="modalTanggalKembali">
                </div>
                
                <div id="dendaPreview" class="denda-preview" style="display: none;">
                    <h4><i class="fas fa-calculator"></i> Perkiraan Denda:</h4>
                    <p>Keterlambatan: <strong id="previewTelat">0 hari</strong></p>
                    <p>Total Denda: <strong id="previewDenda">Rp0</strong></p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="prosesPengembalian()">
                    <i class="fas fa-check"></i> Konfirmasi Pengembalian
                </button>
                <button class="btn btn-secondary" onclick="closeModal()">
                    <i class="fas fa-times"></i> Batal
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // ====================== KONSTANTA DAN VARIABEL GLOBAL ======================
        const DENDA_PER_HARI = 5000; // Rp5.000 per hari
        const peminjamanList = JSON.parse(localStorage.getItem('peminjamanBuku')) || [];
        let currentInvoice = null;
        let currentPage = 1;
        const itemsPerPage = 10;
        let reportChart = null;

        // ====================== INISIALISASI ======================
        document.addEventListener('DOMContentLoaded', function() {
            // Set tanggal default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tanggalPinjam').value = today;
            document.getElementById('modalTanggalKembali').value = today;
            document.getElementById('filterDari').value = getFirstDayOfMonth();
            document.getElementById('filterSampai').value = today;
            document.getElementById('reportDate').value = getCurrentWeek();

            // Load data awal
            updateTabelPengembalian();
            updateTabelRiwayat();
            generateReport();

            // Event listeners
            setupEventListeners();
        });

        // ====================== FUNGSI UTAMA ======================
        function setupEventListeners() {
            // Tab navigation
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    openTab(tabId);
                });
            });

            // Form peminjaman
            document.getElementById('btnSimpan').addEventListener('click', simpanPeminjaman);

            // Pengembalian buku
            document.getElementById('searchPeminjaman').addEventListener('input', searchPeminjaman);
            document.getElementById('btnPrintInvoice').addEventListener('click', printInvoice);
            document.getElementById('btnCloseInvoice').addEventListener('click', closeInvoice);

            // Riwayat peminjaman
            document.getElementById('searchRiwayat').addEventListener('input', searchRiwayat);
            document.getElementById('btnFilter').addEventListener('click', updateTabelRiwayat);
            document.getElementById('btnPrev').addEventListener('click', prevPage);
            document.getElementById('btnNext').addEventListener('click', nextPage);

            // Laporan
            document.getElementById('reportType').addEventListener('change', updateReportControls);
            document.getElementById('btnGenerateReport').addEventListener('click', generateReport);
            document.getElementById('btnExportReport').addEventListener('click', exportReport);

            // Preview denda saat memilih tanggal pengembalian
            document.getElementById('modalTanggalKembali').addEventListener('change', previewDenda);
        }

        // ====================== MANAJEMEN TAB ======================
        function openTab(tabId) {
            // Sembunyikan semua tab content
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Nonaktifkan semua tab button
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Aktifkan tab yang dipilih
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`.tab-btn[data-tab="${tabId}"]`).classList.add('active');

            // Jika tab laporan dibuka, generate report
            if (tabId === 'laporan') {
                generateReport();
            }
        }

        // ====================== FUNGSI PEMINJAMAN ======================
        function simpanPeminjaman() {
            // Ambil nilai dari form
            const nama = document.getElementById('namaPeminjam').value.trim();
            const noHp = document.getElementById('noHp').value.trim();
            const email = document.getElementById('email').value.trim();
            const judul = document.getElementById('judulBuku').value.trim();
            const kodeBuku = document.getElementById('kodeBuku').value.trim();
            const tglPinjam = document.getElementById('tanggalPinjam').value;
            const lama = parseInt(document.getElementById('lamaPinjam').value);

            // Validasi input
            if (!nama || !noHp || !judul || !kodeBuku || !tglPinjam || !lama) {
                showAlert('error', 'Harap isi semua field yang wajib!');
                return;
            }

            // Validasi nomor HP
            if (!/^[0-9]{10,13}$/.test(noHp)) {
                showAlert('error', 'Nomor HP tidak valid!');
                return;
            }

            // Validasi email jika diisi
            if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                showAlert('error', 'Format email tidak valid!');
                return;
            }

            // Hitung tanggal tempo
            const tglPinjamObj = new Date(tglPinjam);
            const tglTempo = new Date(tglPinjamObj);
            tglTempo.setDate(tglPinjamObj.getDate() + (lama * 7));

            // Buat objek peminjaman baru
            const peminjaman = {
                id: Date.now(),
                nama: nama,
                noHp: noHp,
                email: email || null,
                judul: judul,
                kodeBuku: kodeBuku,
                tglPinjam: tglPinjam,
                tglTempo: tglTempo.toISOString().split('T')[0],
                tglKembali: null,
                denda: 0,
                hariTelat: 0,
                status: 'Dipinjam',
                invoice: null,
                createdAt: new Date().toISOString()
            };

            // Tambahkan ke array
            peminjamanList.push(peminjaman);
            
            // Simpan ke localStorage
            saveToLocalStorage();
            
            // Update tampilan
            updateTabelPengembalian();
            updateTabelRiwayat();
            
            // Reset form dan tampilkan notifikasi
            document.getElementById('formPeminjaman').reset();
            document.getElementById('tanggalPinjam').value = new Date().toISOString().split('T')[0];
            
            showAlert('success', 'Peminjaman berhasil disimpan!');
        }

        // ====================== FUNGSI PENGEMBALIAN ======================
        function updateTabelPengembalian() {
            const tbody = document.getElementById('pengembalianBody');
            tbody.innerHTML = '';

            // Filter hanya peminjaman yang belum dikembalikan
            const activePeminjaman = peminjamanList.filter(p => !p.tglKembali);
            
            if (activePeminjaman.length === 0) {
                tbody.innerHTML = `<tr><td colspan="7" class="text-center">Tidak ada data peminjaman aktif</td></tr>`;
                return;
            }

            // Urutkan berdasarkan tanggal pinjam (terlama pertama)
            activePeminjaman.sort((a, b) => new Date(a.tglPinjam) - new Date(b.tglPinjam));

            // Isi tabel
            activePeminjaman.forEach((peminjaman, index) => {
                const row = document.createElement('tr');
                
                // Cek status keterlambatan
                const today = new Date();
                const tglTempo = new Date(peminjaman.tglTempo);
                const isLate = today > tglTempo;
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${peminjaman.nama}</td>
                    <td>${peminjaman.judul}</td>
                    <td>${peminjaman.kodeBuku}</td>
                    <td>${formatDate(peminjaman.tglPinjam)}</td>
                    <td class="${isLate ? 'text-danger' : ''}">
                        ${formatDate(peminjaman.tglTempo)}
                        ${isLate ? '<i class="fas fa-exclamation-circle"></i>' : ''}
                    </td>
                    <td>
                        <button class="btn btn-small" onclick="openPengembalianModal(${peminjaman.id})">
                            <i class="fas fa-undo"></i> Proses
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function openPengembalianModal(id) {
            const peminjaman = peminjamanList.find(p => p.id === id);
            if (!peminjaman) return;

            const modal = document.getElementById('pengembalianModal');
            const modalContent = document.getElementById('modalContent');
            
            // Isi konten modal
            modalContent.innerHTML = `
                <div class="modal-detail">
                    <p><span><i class="fas fa-user"></i> Nama:</span> ${peminjaman.nama}</p>
                    <p><span><i class="fas fa-phone"></i> No. HP:</span> ${peminjaman.noHp}</p>
                    ${peminjaman.email ? `<p><span><i class="fas fa-envelope"></i> Email:</span> ${peminjaman.email}</p>` : ''}
                </div>
                <div class="modal-detail">
                    <p><span><i class="fas fa-book"></i> Judul Buku:</span> ${peminjaman.judul}</p>
                    <p><span><i class="fas fa-barcode"></i> Kode Buku:</span> ${peminjaman.kodeBuku}</p>
                </div>
                <div class="modal-detail">
                    <p><span><i class="fas fa-calendar-day"></i> Tanggal Pinjam:</span> ${formatDate(peminjaman.tglPinjam)}</p>
                    <p><span><i class="fas fa-calendar-check"></i> Jatuh Tempo:</span> ${formatDate(peminjaman.tglTempo)}</p>
                </div>
            `;

            // Set tanggal default pengembalian ke hari ini
            document.getElementById('modalTanggalKembali').value = new Date().toISOString().split('T')[0];
            
            // Reset preview denda
            document.getElementById('dendaPreview').style.display = 'none';
            
            // Simpan ID peminjaman di atribut modal
            modal.setAttribute('data-peminjaman-id', id);
            
            // Tampilkan modal
            modal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('pengembalianModal').style.display = 'none';
        }

        function previewDenda() {
            const modal = document.getElementById('pengembalianModal');
            const id = parseInt(modal.getAttribute('data-peminjaman-id'));
            const tglKembali = document.getElementById('modalTanggalKembali').value;
            
            if (!tglKembali) return;

            const peminjaman = peminjamanList.find(p => p.id === id);
            if (!peminjaman) return;

            const tglKembaliObj = new Date(tglKembali);
            const tglTempoObj = new Date(peminjaman.tglTempo);
            
            let hariTelat = 0;
            let denda = 0;
            
            if (tglKembaliObj > tglTempoObj) {
                const diffTime = tglKembaliObj - tglTempoObj;
                hariTelat = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                denda = hariTelat * DENDA_PER_HARI;
            }
            
            // Tampilkan preview
            const previewElement = document.getElementById('dendaPreview');
            document.getElementById('previewTelat').textContent = `${hariTelat} hari`;
            document.getElementById('previewDenda').textContent = formatCurrency(denda);
            previewElement.style.display = 'block';
        }

        function prosesPengembalian() {
            const modal = document.getElementById('pengembalianModal');
            const id = parseInt(modal.getAttribute('data-peminjaman-id'));
            const tglKembali = document.getElementById('modalTanggalKembali').value;
            
            if (!tglKembali) {
                showAlert('error', 'Harap masukkan tanggal kembali!');
                return;
            }

            const peminjaman = peminjamanList.find(p => p.id === id);
            if (!peminjaman) return;

            const tglKembaliObj = new Date(tglKembali);
            const tglTempoObj = new Date(peminjaman.tglTempo);
            
            let hariTelat = 0;
            let denda = 0;
            
            if (tglKembaliObj > tglTempoObj) {
                const diffTime = tglKembaliObj - tglTempoObj;
                hariTelat = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                denda = hariTelat * DENDA_PER_HARI;
            }
            
            // Update data peminjaman
            peminjaman.tglKembali = tglKembali;
            peminjaman.denda = denda;
            peminjaman.hariTelat = hariTelat;
            peminjaman.status = 'Dikembalikan';
            
            // Generate nomor invoice jika ada denda
            if (denda > 0) {
                const invoiceCount = peminjamanList.filter(p => p.invoice).length + 1;
                const invoiceNumber = `INV-${new Date().getFullYear()}-${invoiceCount.toString().padStart(3, '0')}`;
                peminjaman.invoice = invoiceNumber;
                
                // Tampilkan invoice
                showInvoice(peminjaman);
            }
            
            // Simpan ke localStorage
            saveToLocalStorage();
            
            // Update tampilan
            updateTabelPengembalian();
            updateTabelRiwayat();
            closeModal();
            
            // Tampilkan notifikasi
            if (denda > 0) {
                showAlert('warning', `Buku berhasil dikembalikan dengan denda ${formatCurrency(denda)} (terlambat ${hariTelat} hari)`);
            } else {
                showAlert('success', 'Buku berhasil dikembalikan tepat waktu!');
            }
        }

        function showInvoice(peminjaman) {
            currentInvoice = peminjaman;
            
            // Isi data invoice
            document.getElementById('invoiceNumber').textContent = peminjaman.invoice;
            document.getElementById('invoiceDate').textContent = formatDate(new Date().toISOString());
            document.getElementById('invoiceNama').textContent = peminjaman.nama;
            document.getElementById('invoiceHp').textContent = peminjaman.noHp;
            document.getElementById('invoiceEmail').textContent = peminjaman.email || '-';
            document.getElementById('invoiceJudul').textContent = peminjaman.judul;
            document.getElementById('invoiceKode').textContent = peminjaman.kodeBuku;
            
            // Detail keterlambatan
            document.getElementById('detailPinjam').textContent = formatDate(peminjaman.tglPinjam);
            document.getElementById('detailTempo').textContent = formatDate(peminjaman.tglTempo);
            document.getElementById('detailKembali').textContent = formatDate(peminjaman.tglKembali);
            document.getElementById('detailTelat').textContent = `${peminjaman.hariTelat} hari`;
            
            // Item invoice
            const invoiceItems = document.getElementById('invoiceItems');
            
            if (peminjaman.denda > 0) {
                invoiceItems.innerHTML = `
                    <tr>
                        <td>Denda keterlambatan (${peminjaman.hariTelat} hari @ Rp5.000)</td>
                        <td>${peminjaman.hariTelat}</td>
                        <td>${formatCurrency(DENDA_PER_HARI)}</td>
                        <td>${formatCurrency(peminjaman.denda)}</td>
                    </tr>
                `;
            } else {
                invoiceItems.innerHTML = `
                    <tr>
                        <td colspan="4" class="text-center">Tidak ada denda</td>
                    </tr>
                `;
            }
            
            // Total denda
            document.getElementById('invoiceTotal').textContent = formatCurrency(peminjaman.denda);
            
            // Tampilkan invoice section
            document.getElementById('invoiceSection').style.display = 'block';
            
            // Scroll ke invoice
            document.getElementById('invoiceSection').scrollIntoView({ behavior: 'smooth' });
        }

        function closeInvoice() {
            document.getElementById('invoiceSection').style.display = 'none';
            currentInvoice = null;
        }

        function printInvoice() {
            if (!currentInvoice) return;

            const printContent = document.getElementById('invoiceSection').innerHTML;
            const originalContent = document.body.innerHTML;
            
            document.body.innerHTML = printContent;
            window.print();
            document.body.innerHTML = originalContent;
            
            // Setel ulang tampilan setelah mencetak
            updateTabelPengembalian();
            updateTabelRiwayat();
            document.getElementById('invoiceSection').style.display = 'block';
        }

        function searchPeminjaman() {
            const input = document.getElementById('searchPeminjaman');
            const filter = input.value.toUpperCase();
            const table = document.getElementById('tabelPengembalian');
            const tr = table.getElementsByTagName('tr');
            
            for (let i = 1; i < tr.length; i++) {
                let found = false;
                const td = tr[i].getElementsByTagName('td');
                
                for (let j = 1; j < td.length - 1; j++) { // Skip kolom nomor dan aksi
                    if (td[j]) {
                        const txtValue = td[j].textContent || td[j].innerText;
                        if (txtValue.toUpperCase().indexOf(filter) > -1) {
                            found = true;
                            break;
                        }
                    }
                }
                
                tr[i].style.display = found ? '' : 'none';
            }
        }

        // ====================== FUNGSI RIWAYAT ======================
        function updateTabelRiwayat() {
            const tbody = document.getElementById('riwayatBody');
            tbody.innerHTML = '';
            
            // Ambil filter tanggal
            const dari = document.getElementById('filterDari').value;
            const sampai = document.getElementById('filterSampai').value;
            
            // Filter data berdasarkan tanggal
            let filteredData = peminjamanList.filter(p => {
                const tglPinjam = new Date(p.tglPinjam);
                const dariDate = new Date(dari);
                const sampaiDate = new Date(sampai);
                
                return tglPinjam >= dariDate && tglPinjam <= sampaiDate;
            });
            
            // Filter berdasarkan pencarian jika ada
            const searchTerm = document.getElementById('searchRiwayat').value.toUpperCase();
            if (searchTerm) {
                filteredData = filteredData.filter(p => 
                    p.nama.toUpperCase().includes(searchTerm) || 
                    p.judul.toUpperCase().includes(searchTerm) || 
                    p.kodeBuku.toUpperCase().includes(searchTerm)
                );
            }
            
            // Hitung total data dan denda
            const totalData = filteredData.length;
            const totalDenda = filteredData.reduce((sum, p) => sum + p.denda, 0);
            
            document.getElementById('totalData').textContent = totalData;
            document.getElementById('totalDenda').textContent = formatCurrency(totalDenda);
            
            if (totalData === 0) {
                tbody.innerHTML = `<tr><td colspan="10" class="text-center">Tidak ada data yang ditemukan</td></tr>`;
                updatePaginationControls(0);
                return;
            }
            
            // Urutkan berdasarkan tanggal pinjam (terbaru pertama)
            filteredData.sort((a, b) => new Date(b.tglPinjam) - new Date(a.tglPinjam));
            
            // Pagination
            const totalPages = Math.ceil(totalData / itemsPerPage);
            updatePaginationControls(totalPages);
            
            const startIndex = (currentPage - 1) * itemsPerPage;
            const paginatedData = filteredData.slice(startIndex, startIndex + itemsPerPage);
            
            // Isi tabel
            paginatedData.forEach((peminjaman, index) => {
                const row = document.createElement('tr');
                const noUrut = startIndex + index + 1;
                
                row.innerHTML = `
                    <td>${noUrut}</td>
                    <td>${peminjaman.nama}</td>
                    <td>${peminjaman.judul}</td>
                    <td>${peminjaman.kodeBuku}</td>
                    <td>${formatDate(peminjaman.tglPinjam)}</td>
                    <td>${formatDate(peminjaman.tglTempo)}</td>
                    <td>${peminjaman.tglKembali ? formatDate(peminjaman.tglKembali) : '-'}</td>
                    <td class="${peminjaman.hariTelat > 0 ? 'text-danger' : ''}">
                        ${peminjaman.hariTelat > 0 ? `${peminjaman.hariTelat} hari` : '-'}
                    </td>
                    <td class="${peminjaman.denda > 0 ? 'denda' : ''}">
                        ${peminjaman.denda > 0 ? formatCurrency(peminjaman.denda) : '-'}
                    </td>
                    <td>
                        <span class="status-badge ${peminjaman.status === 'Dipinjam' ? 'status-active' : 'status-completed'}">
                            ${peminjaman.status}
                        </span>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function searchRiwayat() {
            currentPage = 1;
            updateTabelRiwayat();
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                updateTabelRiwayat();
            }
        }

        function nextPage() {
            const totalData = peminjamanList.length;
            const totalPages = Math.ceil(totalData / itemsPerPage);
            
            if (currentPage < totalPages) {
                currentPage++;
                updateTabelRiwayat();
            }
        }

        function updatePaginationControls(totalPages) {
            const pageInfo = document.getElementById('pageInfo');
            const btnPrev = document.getElementById('btnPrev');
            const btnNext = document.getElementById('btnNext');
            
            if (totalPages === 0) {
                pageInfo.textContent = 'Tidak ada data';
                btnPrev.disabled = true;
                btnNext.disabled = true;
                return;
            }
            
            pageInfo.textContent = `Halaman ${currentPage} dari ${totalPages}`;
            btnPrev.disabled = currentPage === 1;
            btnNext.disabled = currentPage === totalPages;
        }

        // ====================== FUNGSI LAPORAN ======================
        function updateReportControls() {
            const reportType = document.getElementById('reportType').value;
            const dateRangeControls = document.getElementById('dateRangeControls');
            
            switch (reportType) {
                case 'mingguan':
                    dateRangeControls.innerHTML = `
                        <label for="reportDate">Pilih Minggu:</label>
                        <input type="week" id="reportDate">
                    `;
                    break;
                case 'bulanan':
                    dateRangeControls.innerHTML = `
                        <label for="reportDate">Pilih Bulan:</label>
                        <input type="month" id="reportDate">
                    `;
                    break;
                case 'tahunan':
                    dateRangeControls.innerHTML = `
                        <label for="reportDate">Pilih Tahun:</label>
                        <input type="number" id="reportDate" min="2000" max="2099" step="1" value="${new Date().getFullYear()}">
                    `;
                    break;
            }
        }

        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const reportDate = document.getElementById('reportDate').value;
            
            let startDate, endDate;
            
            switch (reportType) {
                case 'mingguan':
                    // Parse input week (format: YYYY-Www)
                    const [year, week] = reportDate.split('-W').map(Number);
                    startDate = getDateOfWeek(week, year);
                    endDate = new Date(startDate);
                    endDate.setDate(startDate.getDate() + 6);
                    break;
                    
                case 'bulanan':
                    // Parse input month (format: YYYY-MM)
                    const [yearMonth, month] = reportDate.split('-').map(Number);
                    startDate = new Date(yearMonth, month - 1, 1);
                    endDate = new Date(yearMonth, month, 0); // Last day of month
                    break;
                    
                case 'tahunan':
                    const year = parseInt(reportDate);
                    startDate = new Date(year, 0, 1);
                    endDate = new Date(year, 11, 31);
                    break;
            }
            
            // Filter data berdasarkan periode
            const filteredData = peminjamanList.filter(p => {
                const tglPinjam = new Date(p.tglPinjam);
                return tglPinjam >= startDate && tglPinjam <= endDate;
            });
            
            // Hitung statistik
            const totalPeminjaman = filteredData.length;
            const tepatWaktu = filteredData.filter(p => p.tglKembali && p.hariTelat === 0).length;
            const terlambat = filteredData.filter(p => p.tglKembali && p.hariTelat > 0).length;
            const totalDenda = filteredData.reduce((sum, p) => sum + p.denda, 0);
            
            // Update summary cards
            document.getElementById('totalPeminjaman').textContent = totalPeminjaman;
            document.getElementById('tepatWaktu').textContent = tepatWaktu;
            document.getElementById('terlambat').textContent = terlambat;
            document.getElementById('reportDenda').textContent = formatCurrency(totalDenda);
            
            // Siapkan data untuk chart dan tabel
            prepareChartData(filteredData, reportType, startDate, endDate);
            prepareReportTable(filteredData, reportType);
        }

        function prepareChartData(data, reportType, startDate, endDate) {
            const ctx = document.getElementById('reportChart').getContext('2d');
            
            // Hapus chart sebelumnya jika ada
            if (reportChart) {
                reportChart.destroy();
            }
            
            let labels = [];
            let dataTepatWaktu = [];
            let dataTerlambat = [];
            
            // Buat label dan data berdasarkan jenis laporan
            switch (reportType) {
                case 'mingguan':
                    // Untuk mingguan, kita tampilkan per hari
                    labels = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
                    
                    // Inisialisasi array dengan 0
                    dataTepatWaktu = new Array(7).fill(0);
                    dataTerlambat = new Array(7).fill(0);
                    
                    // Hitung data per hari
                    data.forEach(p => {
                        const tglPinjam = new Date(p.tglPinjam);
                        const dayOfWeek = tglPinjam.getDay(); // 0=Minggu, 1=Senin, ..., 6=Sabtu
                        
                        if (p.tglKembali) {
                            if (p.hariTelat > 0) {
                                dataTerlambat[dayOfWeek]++;
                            } else {
                                dataTepatWaktu[dayOfWeek]++;
                            }
                        }
                    });
                    break;
                    
                case 'bulanan':
                    // Untuk bulanan, kita tampilkan per minggu
                    const weeksInMonth = Math.ceil((endDate.getDate() + startDate.getDay()) / 7);
                    
                    for (let i = 1; i <= weeksInMonth; i++) {
                        labels.push(`Minggu ${i}`);
                    }
                    
                    // Inisialisasi array
                    dataTepatWaktu = new Array(weeksInMonth).fill(0);
                    dataTerlambat = new Array(weeksInMonth).fill(0);
                    
                    // Hitung data per minggu
                    data.forEach(p => {
                        const tglPinjam = new Date(p.tglPinjam);
                        const weekOfMonth = Math.ceil((tglPinjam.getDate() + startDate.getDay()) / 7) - 1;
                        
                        if (p.tglKembali) {
                            if (p.hariTelat > 0) {
                                dataTerlambat[weekOfMonth]++;
                            } else {
                                dataTepatWaktu[weekOfMonth]++;
                            }
                        }
                    });
                    break;
                    
                case 'tahunan':
                    // Untuk tahunan, kita tampilkan per bulan
                    labels = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Ags', 'Sep', 'Okt', 'Nov', 'Des'];
                    
                    // Inisialisasi array
                    dataTepatWaktu = new Array(12).fill(0);
                    dataTerlambat = new Array(12).fill(0);
                    
                    // Hitung data per bulan
                    data.forEach(p => {
                        const tglPinjam = new Date(p.tglPinjam);
                        const month = tglPinjam.getMonth(); // 0-11
                        
                        if (p.tglKembali) {
                            if (p.hariTelat > 0) {
                                dataTerlambat[month]++;
                            } else {
                                dataTepatWaktu[month]++;
                            }
                        }
                    });
                    break;
            }
            
            // Buat chart baru
            reportChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Tepat Waktu',
                            data: dataTepatWaktu,
                            backgroundColor: '#2ecc71',
                            borderColor: '#27ae60',
                            borderWidth: 1
                        },
                        {
                            label: 'Terlambat',
                            data: dataTerlambat,
                            backgroundColor: '#e74c3c',
                            borderColor: '#c0392b',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Jumlah Peminjaman'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: reportType === 'mingguan' ? 'Hari dalam Minggu' : 
                                      reportType === 'bulanan' ? 'Minggu dalam Bulan' : 'Bulan dalam Tahun'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: `Statistik Peminjaman ${getReportTitle(reportType)}`,
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            position: 'top'
                        }
                    }
                }
            });
        }

        function prepareReportTable(data, reportType) {
            const tbody = document.getElementById('reportBody');
            tbody.innerHTML = '';
            
            let groupedData = {};
            
            // Kelompokkan data berdasarkan periode
            data.forEach(p => {
                const tglPinjam = new Date(p.tglPinjam);
                let key;
                
                switch (reportType) {
                    case 'mingguan':
                        key = formatDate(p.tglPinjam);
                        break;
                    case 'bulanan':
                        key = `Minggu ${Math.ceil(tglPinjam.getDate() / 7)}`;
                        break;
                    case 'tahunan':
                        key = tglPinjam.toLocaleString('id-ID', { month: 'long' });
                        break;
                }
                
                if (!groupedData[key]) {
                    groupedData[key] = {
                        jumlah: 0,
                        tepatWaktu: 0,
                        terlambat: 0,
                        denda: 0
                    };
                }
                
                groupedData[key].jumlah++;
                
                if (p.tglKembali) {
                    if (p.hariTelat > 0) {
                        groupedData[key].terlambat++;
                        groupedData[key].denda += p.denda;
                    } else {
                        groupedData[key].tepatWaktu++;
                    }
                }
            });
            
            // Urutkan data berdasarkan periode
            const sortedKeys = Object.keys(groupedData).sort((a, b) => {
                if (reportType === 'mingguan') {
                    return new Date(a) - new Date(b);
                } else if (reportType === 'bulanan') {
                    return parseInt(a.split(' ')[1]) - parseInt(b.split(' ')[1]);
                } else { // tahunan
                    const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 
                                   'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
                    return months.indexOf(a) - months.indexOf(b);
                }
            });
            
            // Isi tabel
            sortedKeys.forEach((key, index) => {
                const row = document.createElement('tr');
                const item = groupedData[key];
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${key}</td>
                    <td>${item.jumlah}</td>
                    <td>${item.tepatWaktu}</td>
                    <td>${item.terlambat}</td>
                    <td>${formatCurrency(item.denda)}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function exportReport() {
            // Dalam implementasi nyata, ini akan meng-generate PDF
            // Di sini kita hanya simulasi dengan window.print()
            window.print();
        }

        // ====================== FUNGSI UTILITAS ======================
        function saveToLocalStorage() {
            localStorage.setItem('peminjamanBuku', JSON.stringify(peminjamanList));
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', {
                weekday: 'short',
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            });
        }

        function formatCurrency(amount) {
            return 'Rp' + amount.toLocaleString('id-ID');
        }

        function showAlert(type, message) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'times-circle' : 'exclamation-circle'}"></i>
                ${message}
            `;
            
            document.body.appendChild(alert);
            
            // Hilangkan alert setelah 3 detik
            setTimeout(() => {
                alert.classList.add('fade-out');
                setTimeout(() => alert.remove(), 500);
            }, 3000);
        }

        function getFirstDayOfMonth() {
            const date = new Date();
            return new Date(date.getFullYear(), date.getMonth(), 1).toISOString().split('T')[0];
        }

        function getCurrentWeek() {
            const date = new Date();
            date.setHours(0, 0, 0, 0);
            date.setDate(date.getDate() + 3 - (date.getDay() + 6) % 7);
            const week1 = new Date(date.getFullYear(), 0, 4);
            return date.getFullYear() + '-W' + 
                   Math.round(((date - week1) / 86400000 + week1.getDay() + 1) / 7).toString().padStart(2, '0');
        }

        function getDateOfWeek(week, year) {
            const date = new Date(year, 0, 1 + (week - 1) * 7);
            const dayOfWeek = date.getDay();
            const diff = date.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1);
            return new Date(date.setDate(diff));
        }

        function getReportTitle(reportType) {
            const reportDate = document.getElementById('reportDate').value;
            
            switch (reportType) {
                case 'mingguan':
                    return `Minggu ${reportDate.split('-W')[1]} Tahun ${reportDate.split('-')[0]}`;
                case 'bulanan':
                    const [year, month] = reportDate.split('-');
                    return new Date(year, month - 1, 1).toLocaleDateString('id-ID', { month: 'long', year: 'numeric' });
                case 'tahunan':
                    return `Tahun ${reportDate}`;
            }
        }
    </script>

    <style>
        /* ====================== GLOBAL STYLES ====================== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f7fa;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        header .subtitle {
            font-size: 14px;
            opacity: 0.8;
        }
        
        /* ====================== TAB STYLES ====================== */
        .tabs {
            display: flex;
            background-color: #34495e;
        }
        
        .tab-btn {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .tab-btn:hover {
            background-color: #3d566e;
        }
        
        .tab-btn.active {
            background-color: #2980b9;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* ====================== CARD STYLES ====================== */
        .card {
            background-color: white;
            border-radius: 6px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .card h2 {
            padding: 15px 20px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #eee;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-card {
            border-left: 4px solid #3498db;
        }
        
        .info-card ul {
            padding: 15px 20px 15px 40px;
            list-style-type: none;
        }
        
        .info-card li {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-card {
            padding-bottom: 20px;
        }
        
        /* ====================== FORM STYLES ====================== */
        .form-group {
            margin-bottom: 15px;
            padding: 0 20px;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
            padding: 0;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            font-size: 14px;
        }
        
        input, select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: border 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .form-actions {
            padding: 0 20px;
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        /* ====================== BUTTON STYLES ====================== */
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-secondary {
            background-color: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #7f8c8d;
        }
        
        .btn-small {
            padding: 6px 10px;
            font-size: 13px;
        }
        
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-success {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        /* ====================== TABLE STYLES ====================== */
        .table-responsive {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }
        
        tr:hover {
            background-color: #f5f7fa;
        }
        
        .text-center {
            text-align: center;
        }
        
        .text-right {
            text-align: right;
        }
        
        .text-danger {
            color: #e74c3c;
        }
        
        .denda {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-active {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        
        .status-completed {
            background-color: #e8f5e9;
            color: #388e3c;
        }
        
        /* ====================== SEARCH BOX ====================== */
        .search-box {
            position: relative;
            margin: 0 20px 15px;
        }
        
        .search-box i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #95a5a6;
        }
        
        .search-box input {
            padding-left: 35px;
            width: 100%;
        }
        
        /* ====================== INVOICE STYLES ====================== */
        .invoice-section {
            margin-top: 30px;
            animation: fadeIn 0.5s;
        }
        
        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .invoice-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .invoice-logo i {
            color: #3498db;
        }
        
        .invoice-meta {
            text-align: right;
        }
        
        .invoice-meta h3 {
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .invoice-meta p {
            font-size: 14px;
            color: #7f8c8d;
        }
        
        .invoice-meta p span:first-child {
            font-weight: 500;
            color: #34495e;
        }
        
        .invoice-details {
            display: flex;
            padding: 20px;
            gap: 30px;
        }
        
        .invoice-customer, .invoice-book {
            flex: 1;
        }
        
        .invoice-details h4 {
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 16px;
            padding-bottom: 5px;
            border-bottom: 1px dashed #ddd;
        }
        
        .invoice-details p {
            margin-bottom: 5px;
            font-size: 14px;
            display: flex;
        }
        
        .invoice-details p span:first-child {
            min-width: 80px;
            font-weight: 500;
            color: #34495e;
        }
        
        .keterlambatan-info {
            padding: 0 20px;
            margin-bottom: 20px;
        }
        
        .keterlambatan-info h4 {
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .keterlambatan-detail {
            display: flex;
            background-color: #f8f9fa;
            border-radius: 6px;
            padding: 15px;
            gap: 15px;
        }
        
        .keterlambatan-detail > div {
            flex: 1;
            text-align: center;
        }
        
        .keterlambatan-detail p {
            font-size: 13px;
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        
        .keterlambatan-detail strong {
            font-size: 16px;
            color: #2c3e50;
        }
        
        .invoice-items {
            width: 100%;
            margin: 0 20px 20px;
            border-collapse: collapse;
        }
        
        .invoice-items th {
            background-color: #f8f9fa;
            padding: 10px 15px;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .invoice-items td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .invoice-total {
            padding: 0 20px;
            margin-bottom: 20px;
            text-align: right;
            font-size: 16px;
            font-weight: 600;
        }
        
        .payment-methods {
            padding: 0 20px;
            margin-bottom: 20px;
        }
        
        .payment-methods h4 {
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .methods {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }
        
        .methods > div {
            flex: 1;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            text-align: center;
        }
        
        .methods i {
            font-size: 24px;
            color: #3498db;
            margin-bottom: 10px;
        }
        
        .methods p:first-of-type {
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .methods p:last-of-type {
            font-size: 13px;
            color: #7f8c8d;
        }
        
        .invoice-footer {
            padding: 15px 20px;
            background-color: #f8f9fa;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .invoice-footer p {
            font-size: 13px;
            color: #7f8c8d;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .invoice-actions {
            display: flex;
            gap: 10px;
        }
        
        /* ====================== MODAL STYLES ====================== */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            overflow: auto;
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            width: 90%;
            max-width: 600px;
            border-radius: 6px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: modalFadeIn 0.3s;
        }
        
        .modal-header {
            padding: 15px 20px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .close {
            color: #95a5a6;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .close:hover {
            color: #7f8c8d;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-detail {
            margin-bottom: 15px;
        }
        
        .modal-detail p {
            margin-bottom: 8px;
            display: flex;
        }
        
        .modal-detail p span:first-child {
            min-width: 120px;
            font-weight: 500;
            color: #34495e;
        }
        
        .denda-preview {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-top: 15px;
            border-radius: 4px;
        }
        
        .denda-preview h4 {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .denda-preview p {
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }
        
        .modal-footer {
            padding: 15px 20px;
            background-color: #f8f9fa;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* ====================== FILTER CONTROLS ====================== */
        .filter-controls {
            display: flex;
            justify-content: space-between;
            padding: 0 20px 15px;
            gap: 15px;
        }
        
        .date-filter {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .date-filter label {
            margin-bottom: 0;
            font-size: 13px;
        }
        
        .date-filter input {
            width: auto;
            padding: 6px 10px;
        }
        
        /* ====================== TABLE FOOTER ====================== */
        .table-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-top: 1px solid #eee;
        }
        
        .summary {
            display: flex;
            gap: 15px;
        }
        
        .summary p {
            font-size: 13px;
        }
        
        .summary p span {
            font-weight: 500;
        }
        
        .pagination {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .pagination span {
            font-size: 13px;
        }
        
        /* ====================== REPORT CONTROLS ====================== */
        .report-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 0 20px 15px;
            align-items: center;
        }
        
        .report-controls > div {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .report-controls label {
            margin-bottom: 0;
            font-size: 13px;
        }
        
        .report-controls select, 
        .report-controls input {
            width: auto;
            padding: 6px 10px;
        }
        
        /* ====================== REPORT SUMMARY ====================== */
        .report-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 0 20px 20px;
        }
        
        .summary-card {
            background-color: white;
            border-radius: 6px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .summary-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #e3f2fd;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #1976d2;
            font-size: 20px;
        }
        
        .summary-content p {
            font-size: 13px;
            color: #7f8c8d;
            margin-bottom: 3px;
        }
        
        .summary-content h3 {
            font-size: 22px;
            color: #2c3e50;
        }
        
        /* ====================== CHART CONTAINER ====================== */
        .chart-container {
            position: relative;
            height: 300px;
            margin: 0 20px 20px;
        }
        
        /* ====================== ALERT STYLES ====================== */
        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 4px;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            z-index: 1100;
            animation: slideIn 0.3s;
        }
        
        .alert-success {
            background-color: #2ecc71;
        }
        
        .alert-error {
            background-color: #e74c3c;
        }
        
        .alert-warning {
            background-color: #f39c12;
        }
        
        .fade-out {
            animation: fadeOut 0.5s;
        }
        
        /* ====================== ANIMATIONS ====================== */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes modalFadeIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* ====================== RESPONSIVE STYLES ====================== */
        @media (max-width: 768px) {
            .form-row, 
            .invoice-details,
            .keterlambatan-detail,
            .methods,
            .filter-controls {
                flex-direction: column;
                gap: 15px;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
            
            .report-summary {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .tabs {
                flex-direction: column;
            }
            
            .tab-btn {
                padding: 12px;
                justify-content: flex-start;
            }
            
            .report-summary {
                grid-template-columns: 1fr;
            }
            
            .table-footer {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
        }
    </style>
</body>
</html>